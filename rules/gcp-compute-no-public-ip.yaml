ruleId: gcp-compute-no-public-ip
type: asset
ruleName: >
  Ensure that Compute instances do not have public IP addresses
description: >
  To reduce your attack surface, Compute instances should not have public IP addresses.
  Instead, instances should be configured behind load balancers, to minimize the instance's exposure to the internet.
severity: high
enabled: true
sql: >
  SELECT acc.assetid
    FROM ${magpie_schema}.gcp acc,
  LATERAL (
      SELECT value -> 'accessConfigs' as meta
      FROM jsonb_array_elements("configuration" -> 'networkInterfaces')
    ) arr
  WHERE acc.resourcetype = 'GCP::ComputeEngine::Instance'
    AND acc.assetid NOT LIKE 'gke-%'
    AND meta IS NOT NULL

remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
