id: 419ab56b-0837-4bc8-a04d-b0e184dc2303
ruleId: gcp_001
type: asset
ruleName: >
  Ensure that there are only GCP-managed service account keys for each service account
description: >
  User managed service accounts should not have user-managed keys
severity: high
enabled: true
sql: >
  SELECT key->'name' as asset_id
  FROM
    (SELECT jsonb_array_elements(supplementary_configuration->'keys'->'keys') AS key
     from assets
     WHERE resource_type = 'GCP::Iam::ServiceAccount') AS keys
  WHERE key->>'keyType' = 'USER_MANAGED';
remediation: >
  From Console
    1. Go to the IAM page in the GCP Console using https://console.cloud.google.com/iam-admin/iam
    2. In the left navigation pane, click Service accounts. All service accounts and their corresponding keys are listed.
    3. Click the service account.
    4. Click the edit and delete the keys.
  From CLI To delete a user managed Service Account Key:
    gcloud iam service-accounts keys delete --iam-account=<user-managed-service-account-EMAIL> <KEY-ID>
remediationDocURLs:
  - https://docs.openraven.com/remediations/ensure_AWS_account_security_questions_registered
version: 0.1.3
