id: fafe42dd-54bb-488e-b844-1537cf35a5f4
ruleId: gcp_007
type: asset
ruleName: >
  Ensure that Service Account has no Admin privilege
description: >
  Service accounts represent service-level security of the Resources (application or a VM) which can be determined by the roles assigned to it.
  Enrolling ServiceAccount with Admin rights gives full access to an assigned application or a VM.
  A ServiceAccount Access holder can perform critical actions like delete, update change settings, etc. without user intervention.
  For this reason, it's recommended that service accounts not have Admin rights.
severity: high
enabled: true
sql: >
  SELECT members AS asset_id
  FROM assets acc,
  LATERAL (
        SELECT value ->> 'role_' AS roles, jsonb_array_elements_text(value -> 'members_') AS members
        FROM jsonb_array_elements(supplementary_configuration -> 'iamPolicy' -> 'bindings_')
    ) arr
  WHERE acc.resource_type = 'GCP::ResourceManager::Project'
    AND members LIKE '%.gserviceaccount.com%'
    AND roles ILIKE '%admin%'
remediation: >
  From Console
    1. Go to IAM & admin/IAM using https://console.cloud.google.com/iam-admin/iam
    2. Go to the Members
    3. Identify User-Managed user created service account with roles containing *Admin
    or *admin or role matching Editor or role matching Owner
    4. Click the Delete bin icon to remove the role from the member (service account in
    this case)
# remediationDocURLs:
# - https://docs.openraven.com/remediations/delete_gcp_service_account_keys
version: 0.1.3
