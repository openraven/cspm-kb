# id: 2a66998e-64c2-4ce7-9bf4-c667f06d1efb
# opnrvn-r-57
ruleId: aws-management-tools-securityhub-enabled-for-required-region
type: asset
ruleName: >
  Ensure that SecurityHub enabled for required region
description: >
  AWS Security Hub gives you a comprehensive view of your security alerts and security posture across your AWS accounts.
  SecurityHub is a single place that manages
severity: medium
enabled: true
sql: >
  SELECT 'No SecurityHub enabled in discovered region: ' || reg.region_global as arn
    FROM (SELECT distinct awsregion as region_global
            FROM ${magpie_schema}.awssecurityhubstandardsubscription
           WHERE awsregion != 'aws-global') reg
    LEFT JOIN (SELECT awsregion, count (*)
                 FROM ${magpie_schema}.awssecurityhubstandardsubscription
             GROUP BY awsregion, resourcetype
               HAVING resourcetype = 'AWS::SecurityHub::StandardsSubscription' AND count(*) > 0) a
    ON (reg.region_global = a.awsregion or a.awsregion is null)
  WHERE awsregion is null

remediationDocURLs: https://github.com/openraven/security-rules/wiki
version: 0.9
